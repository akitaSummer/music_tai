<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0,minimum=1.0,user-scalable=no">
    <title>Document</title>
    <link rel="stylesheet" href="css/set.css">
</head>

<body>
    <div class="wrap">
        <div class="top">
            <div class="head d-flex ai-center bg-black">
                <img src="img/logo_new.png" class='logo mx-2'>
                <div class='flex-1 d-flex jc-end ai-center'>
                    <img src="img/sbtn.png" class='search'>
                    <a href="javascript:;" class='mx-3 fs-xxs text-white'>登录</a>
                </div>
            </div>
            <div class="nav">
                <ul class="list">
                    <li><a href="javascript:;">首页</a></li>
                    <li><a href="javascript:;">MV</a></li>
                    <li><a href="javascript:;">悦单</a></li>
                    <li><a href="javascript:;">V榜</a></li>
                    <li><a href="javascript:;">音悦</a></li>
                    <li><a href="javascript:;">商城</a></li>
                    <li><a href="javascript:;">节目</a></li>
                    <li><a href="javascript:;">饭团</a></li>
                    <li><a href="javascript:;">咨询</a></li>
                    <li><a href="javascript:;">我的家</a></li>
                    <li><a href="javascript:;">APP下载</a></li>
                    <li><a href="javascript:;">热门应用</a></li>
                    <div class="smallB"></div>
                </ul>
            </div>
        </div>
        <div class="content">
            <div class="carousel-wrap" needCarousel needAuto>
                <div class="points-wrap"></div>
            </div>
        </div>
        <div class="bottom">
            <div class="d-flex ai-center bg-white">
                <img src="img/logo.png" class='logo ml-3 mr-2'>
                <div class='flex-1 fs-xxs text-black'>
                    <p>上音悦Tai客户端</p>
                    <p>高清视频 新歌打榜 最新MV一览无余</p>
                </div>
                <div class='button px-3 mx-2 text-white'>下载</div>
            </div>
        </div>
    </div>
</body>
<script src="js/tools.js"></script>
<script>
    window.onload = () => {
        //禁止默认行为
        document.addEventListener('touchstart', (ev) => {
            ev = ev || window.event
            ev.preventDefault()
        })

        // rem 适配
        ;
        (() => {
            const styleNode = document.createElement('style')
            const width = document.documentElement.clientWidth / 16
            styleNode.innerHTML = `html{font-size: ${width}px!important}`
            document.head.appendChild(styleNode)
        })()

        const arr1 = ['img/001.jpg', 'img/002.jpg', 'img/003.jpg', 'img/004.jpg', 'img/005.png', 'img/006.png', 'img/007.jpg', 'img/008.jpg', 'img/009.jpg', 'img/010.jpg']
        const arr2 = ['img/101.jpg', 'img/102.jpg', 'img/103.jpg', 'img/104.jpg', 'img/105.jpg', 'img/106.jpg']
        const arr3 = ['img/201.jpg', 'img/202.jpg', 'img/203.jpg', 'img/204.jpg', 'img/205.jpg', 'img/206.jpg']

        carousel(arr1)

        const drag = () => {
            // 滑屏区域
            const wrap = document.querySelector('.wrap .top .nav')
                // 滑屏元素
            const item = document.querySelector('.wrap .top .nav .list')
            let startX = 0
            let elementX = 0
            let lastTime = 0
            let timeDis = 0
            let pointDis = 0
            let lastPoint = 0
            const minX = wrap.clientWidth - item.clientWidth
            wrap.addEventListener('touchstart', (ev) => {
                ev = ev || window.event
                const TouchC = ev.changedTouches[0]
                item.style.transition = 'none'
                startX = TouchC.clientX
                elementX = css(item, 'translateX')
                lastTime = new Date().getTime()
                lastPoint = css(item, 'translateX')
            })
            wrap.addEventListener('touchmove', (ev) => {
                ev = ev || window.event
                const TouchC = ev.changedTouches[0]
                const nowX = TouchC.clientX
                const disX = nowX - startX
                let translateX = elementX + disX
                    // 橡皮筋效果
                    // 在touchmove过程中, 每一次touchmove真正的有效距离在减小, 但是元素的滑动距离在增大
                if (translateX > 0) {
                    const scale = document.documentElement.clientWidth / ((document.documentElement.clientWidth + translateX) * 2)
                    translateX = elementX + disX * scale
                } else if (translateX < minX) {
                    console.log(minX)
                    const over = minX - translateX
                    const scale = document.documentElement.clientWidth / ((document.documentElement.clientWidth + over) * 2)
                    translateX = elementX + disX * scale
                }
                css(item, 'translateX', translateX)
                const nowTime = new Date().getTime()
                const nowPoint = css(item, 'translateX')
                timeDis = nowTime - lastTime
                pointDis = nowPoint - lastPoint
                lastTime = nowTime
                lastPoint = nowPoint
            })
            wrap.addEventListener('touchend', (ev) => {
                ev = ev || window.event
                let translateX = css(item, 'translateX')
                const speed = pointDis / timeDis
                let targetX = translateX + speed * 200
                item.style.transition = '1s transform'
                if (targetX > 0) {
                    targetX = 0
                } else if (targetX < minX) {
                    targetX = minX
                }
                css(item, 'translateX', targetX)
            })
        }
        drag()
    }
</script>

</html>